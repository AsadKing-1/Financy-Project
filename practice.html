<div class="chart-container">
    <svg width="120" height="120" viewBox="0 0 120 120" class="donut">
      <circle class="background" cx="60" cy="60" r="50"></circle>
      <circle class="progress" cx="60" cy="60" r="50"></circle>
      <text x="60" y="65" text-anchor="middle" class="percentage">0%</text>
    </svg>
  </div>
  
  <div>
    <label>Общий баланс:</label>
    <input type="number" id="totalBalance" placeholder="Введите баланс" oninput="updateChart()">
  </div>
  <div>
    <label>Убытки:</label>
    <input type="number" id="expenses" placeholder="Введите убытки" oninput="updateChart()">
  </div>
  
  <style>
    .chart-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }
  
    .donut {
      transform-origin: center;
    }
  
    .donut circle {
      fill: none;
      stroke-width: 10;
    }
  
    .background {
      stroke: #ddd; /* Серый фон */
    }
  
    .progress {
      stroke: #ff5733; /* Цвет убытков */
      stroke-dasharray: 314.16; /* Полная длина окружности */
      stroke-dashoffset: 314.16; /* Начальное значение */
      transition: stroke 0.5s ease-in-out;
    }
  
    .percentage {
      font-size: 18px;
      font-weight: bold;
      fill: #333;
    }
  </style>
  
  <script>
    let currentOffset = 314.16;
  
    function updateChart() {
      const totalBalance = parseFloat(document.getElementById("totalBalance").value) || 0;
      const expenses = parseFloat(document.getElementById("expenses").value) || 0;
  
      if (totalBalance === 0) {
        document.querySelector(".percentage").textContent = "0%";
        return;
      }
  
      let percentage = (expenses / totalBalance) * 100;
      percentage = Math.min(100, Math.max(0, percentage));
  
      const circumference = 2 * Math.PI * 50;
      const newOffset = circumference * (1 - percentage / 100);
  
      animateProgress(currentOffset, newOffset, 500);
      animatePercentage(parseInt(document.querySelector(".percentage").textContent), Math.round(percentage), 500);
  
      currentOffset = newOffset;
    }
  
    function animateProgress(from, to, duration) {
      const progressCircle = document.querySelector(".progress");
      const startTime = performance.now();
  
      function step(currentTime) {
        let elapsedTime = currentTime - startTime;
        let progress = Math.min(elapsedTime / duration, 1);
        let easedProgress = easeOutExpo(progress);
        let newOffset = from + (to - from) * easedProgress;
  
        progressCircle.style.strokeDashoffset = newOffset;
  
        if (progress < 1) {
          requestAnimationFrame(step);
        }
      }
  
      requestAnimationFrame(step);
    }
  
    function animatePercentage(from, to, duration) {
      const textElement = document.querySelector(".percentage");
      const startTime = performance.now();
  
      function step(currentTime) {
        let elapsedTime = currentTime - startTime;
        let progress = Math.min(elapsedTime / duration, 1);
        let easedProgress = easeOutExpo(progress);
        let newValue = Math.round(from + (to - from) * easedProgress);
  
        textElement.textContent = newValue + "%";
  
        if (progress < 1) {
          requestAnimationFrame(step);
        }
      }
  
      requestAnimationFrame(step);
    }
  
    function easeOutExpo(t) {
      return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
    }
  </script>
  